<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8">

        <title>VCard</title>
        <meta name="description" content="duda's vcard">
        <meta name="author" content="dudas">
        
        <style>
            #body { background: #2f3234; }        

            i { position:absolute; }

            #wrapper { 
                display: grid;
                grid-template-rows: 30vmin 30vmin 30vmin;
                grid-template-columns: 30vmin 30vmin 30vmin;
                grid-gap: 1vmin;
                color: #444;

                width: 94vmin;
                height: 94vmin;
                margin: 4vmin auto auto auto;
            }

            .box {
                background-color: #444;
                color: #fff;
                border-radius: 5px;
                font-size: 10vmin;

                display: flex;
                justify-content: center;
                align-items: center;

                height: 30vmin;
                width: 30vmin;
            }

            svg {
                fill: #fff;
                height: 10vmin;
                width: auto;
            }

            .trc {
                position: absolute; 
                top: 0; 
                right: 1em; 
                border: 0;

            }

            a:link, a:visited { color: #444; }
        </style>

        <script>//Script for loading json with personal data
            async function contentLoad () {
                var response = await fetch("/info.json", {	method: 'GET' });
                if (response.status != 200) {
                    alert('Contact infos could not be loaded\n error ' + response.status);
                    return (-1);
                }
                response = await response.json();
                document.title = response.name + "'s VCard";

                /*Load design*/
                document.styleSheets[0].cssRules

                /*Load content*/
                response.channels.forEach( x => {
                    var box = document.createElement('div');
                    box.className = "box";
                    box.innerHTML=x.icon;
                    box.addEventListener("click", function() { window.location = x.link });
                    document.getElementById('wrapper').appendChild(box);
                });
            }
        </script>

        <script>//Script for handling the background image
            var counter = 0;
            var oldWidth = 0;
            var oldHeight = 0;
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            async function loadBackground () {
                let me = ++counter;
                await sleep(1000);
                if (me == counter){
                    if (screen.width > oldWidth || screen.height > oldHeight){
                        console.log('oldw: ' + oldWidth);
                        console.log('oldh: ' + oldHeight);
                        
                        document.getElementById("body").style.background="#2f3234 url('https://source.unsplash.com/random/" + screen.width + "x" + screen.height + "'";
                    }
                    oldWidth = screen.width;
                    oldHeight = screen.height;
                }
            }
        </script>

        <script>//Script for errorhandling if fontawesome cannot be loaded
        var faWasLoaded = 0;

        async function faLoad(){
        }
        </script>
        <link onerror="faWasLoaded=1;" rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    </head>
    <body id="body" onload="contentLoad(); loadBackground(); faLoad();" onresize="loadBackground(); faLoad()">
        <div class="trc">
            <a href="https://github.com/8sd/vcard" class="gh"><i class="fab fa-github"></i></a>
        </div>
        <div id="wrapper">
            
        </div>
    </body>
</html>
